# OAuth Project

#### OAuth?

ðŸ’¡ OAuthëŠ” Third party appì—ê²Œ ìœ ì €ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì œê³µí•˜ì§€ ì•Šê³ , ì¸ì¦í•˜ê¸° ìœ„í•´ ë‚˜íƒ€ë‚œ ê°œë…ì´ë‹¤. ì¦‰, Third party appëŠ” ìœ ì €ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì§€ ëª»í•´ë„, ì‚¬ìš©ìžê°€ í—ˆê°€í•œ ìžì›ì— ëŒ€í•´ ì ‘ê·¼í•  ìˆ˜ ìžˆë„ë¡ ë„ì™€ì¤€ë‹¤.

OAuthì—ëŠ” 4ê°œì˜ ì°¸ì—¬ìžê°€ ì¡´ìž¬í•œë‹¤. Third party Appì— í•´ë‹¹í•˜ëŠ” **Client**, ì‹¤ì œ ì•± ì‚¬ìš©ìžì— í•´ë‹¹í•˜ëŠ” **Resource Owner**, ìš”ì²­ ë°ì´í„°ì— ëŒ€í•´ ì‘ë‹µì„ ì£¼ëŠ” **Resource server**, ì¸ì¦ì„ ìˆ˜í–‰í•˜ëŠ” **Authorization Server**ê°€ ì¡´ìž¬í•œë‹¤.

#### ì°¸ì—¬ìž

1.  Resource Owner

    ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ì„œ ì•¡ì„¸ìŠ¤ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìžˆëŠ” ì£¼ì²´ì´ë‹¤. (end userë¼ê³  ë¶€ë¥¸ë‹¤)

    ì•±ìœ¼ë¡œ ì„¤ëª…í•˜ìžë©´, ìž‘ê³  ì†Œì¤‘í•œ ë‚´ ì•±ì˜ ì‚¬ìš©ìžì´ë‹¤. ì´ë“¤ì´ ìžì›ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ShortcutsZipì—ì„œ ì• í”Œë¡œ ë¡œê·¸ì¸ì„ ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìžˆëŠ”ë°, ì²˜ìŒ íšŒì›ê°€ìž…í•  ë•Œ ì´ë¦„, ì´ë©”ì¼, ê¸°íƒ€ ì •ë³´ë¥¼ ì œê³µí• ì§€ ë§ì§€ë¥¼ ê²°ì •í•˜ëŠ” ì£¼ì²´ì´ë‹¤.
2.  Resource Server

    ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” ì„œë²„ë¡œ, access tokenì„ í†µí•´ ìš”ì²­ì„ ë°›ê³ , ì‘ë‹µí•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•œë‹¤.

    ShortcutsZipì—ì„œëŠ” ë”°ë¡œ ìœ ì €ì˜ ì •ë³´ë¥¼ ìš”êµ¬í•˜ì§€ ì•Šì§€ë§Œ, ì˜ˆë¥¼ ë“¤ì–´ ì‚¬ìš©ìžì˜ í”„ë¡œí•„ ì •ë³´, ì‚¬ì§„, ì´ë©”ì¼ ì£¼ì†Œ ë“±ê³¼ ê°™ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•  ë•Œ, ê·¸ ì •ë³´ë¥¼ í˜¸ìŠ¤íŒ…í•´ì£¼ëŠ” ì„œë²„ë¼ê³  ì´í•´í•˜ë©´ ëœë‹¤.
3.  Client

    ë‚´ê°€ ê°œë°œí•œ ì•±ì´ë‹¤. Resource serverì—ì„œ ì œê³µí•˜ëŠ” ì •ë³´ë¥¼ ì‚¬ìš©í•˜ê³ ìží•˜ëŠ” ê³„ì¸µì´ë‹¤.

    ì˜ˆë¥¼ ë“¤ì–´ ì‚¬ìš©ìž Aì˜ ê¹ƒí—ˆë¸Œ ìž”ë”” ì •ë³´ë¥¼ ê°€ì§€ê³  ì˜¤ê³  ì‹¶ë‹¤ë©´, Github Authorization Serverì—ì„œ ì¸ì¦ì„ ë°›ì€ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Resorce serverì—ê²Œ ìž”ë”” ì •ë³´ë¥¼ ìš”ì²­í•  ìˆ˜ ìžˆëŠ” ê²ƒì´ë‹¤.
4.  Authorization Server

    Resource Ownerë¥¼ ì¸ì¦í•˜ê³ , ê¶Œí•œì„ ì–»ì€ í›„ì—, Clientì—ê²Œ Access Tokenì„ ë°œê¸‰í•œë‹¤.

    ì¦‰, ì‚¬ìš©ìžê°€ Apple ì•„ì´ë””ë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´, ì‚¬ìš©ìžê°€ ì œê³µí•œë‹¤ê³  ì²´í¬í•œ ì •ë³´ë¥¼ ìžì‹ ì˜ ì„œë²„ì— ì €ìž¥í•œë‹¤. ì´í›„ì— ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Access Tokenì„ ë°œê¸‰í•˜ì—¬ Resource Serverì—ê²Œ ì œê³µí•˜ê²Œ ëœë‹¤.

ì •ë¦¬í•˜ìžë©´, Resource Ownerê°€ Clientë¥¼ ì‚¬ìš©í•˜ê³ ìž í•œë‹¤. ì´ë•Œ Resource OwnerëŠ” Authorization Serverë¥¼ í†µí•´ ìžì‹ ì„ ì¸ì¦í•˜ê³ , ì–´ë–¤ ê¶Œí•œì„ í—ˆìš©í• ì§€ ì„ íƒí•œë‹¤. ê·¸ëŸ¬ë©´ Authorization ServerëŠ” ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Access Tokenì„ Clientì— ì œê³µí•œë‹¤. ì´í›„ ClientëŠ” Access Tokenì„ í†µí•´ Resource Serverì—ê²Œ ë°ì´í„°ë¥¼ ìš”ì²­í•  ìˆ˜ ìžˆê³ , Resource serverëŠ” í† í°ê³¼ ìš”ì²­ì„ ë¹„êµí•˜ì—¬ ë°ì´í„°ë¥¼ ì œê³µí•˜ê²Œ ëœë‹¤.

(ì•„ì§ì€ ë‹¨ì–´ê°€ ìµìˆ™í•˜ì§€ ì•Šì•„ì„œ í—·ê°ˆë¦´ ìˆ˜ ìžˆì§€ë§Œ, ìš©ì–´ê°€ ìµìˆ™í•´ì§€ë©´ êµ‰ìž¥ížˆ ì‰¬ìš¸ ê²ƒì´ë‹¤.)



#### OAuth ê³¼ì •

**ì„œë¹„ìŠ¤ ë“±ë¡** â†’ **Resource Serverì˜ ì¸ì¦** â†’ **Authorization Serverì˜ ìŠ¹ì¸** â†’ **Access Token ë°œê¸‰**ì˜ ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì§€ê²Œ ëœë‹¤. (refresh tokenì€ ë³„ê°œ) ê·¸ëŸ¼ ì´ ë‹¨ê³„ì— ëŒ€í•´ ì°¨ê·¼ì°¨ê·¼ ì•Œì•„ë³´ìž.

1.  ì„œë¹„ìŠ¤ ë“±ë¡ (`**Client Registration**`)

    Authorization Serverì—ì„œ Clientë¥¼ ì‹ë³„í•  ìˆ˜ ìžˆë„ë¡ redirection URIì™€ í•¨ê»˜ ë“±ë¡í•´ì•¼í•œë‹¤. ì´ ê³¼ì •ì„ ê±°ì¹˜ë©´ Client ID, Client Secretì„ ë°œê¸‰ë°›ì„ ìˆ˜ ìžˆë‹¤.

    **client ID**ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ì‹ë³„ìžë¡œ, Authorization serverê°€ clientë¥¼ ì‹ë³„í•  ë•Œ ì‚¬ìš©í•˜ê²Œ ëœë‹¤. **client secret**ì€ ì‹ ì›ì„ í™•ì¸í•˜ê³ , í†µì‹ ì˜ ì‹ ë¢°ì„±ì— ì¤‘ìš”í•œ ì—­í• ì„ í•˜ëŠ” ê°’ìœ¼ë¡œ ì ˆëŒ€ ì™¸ë¶€ë¡œ ë…¸ì¶œë˜ì–´ì„œëŠ” ì•ˆ ëœë‹¤.**redirection URI**ëŠ” ì‚¬ìš©ìžê°€ ì¸ì¦ í›„ì— redirection ì‹œí‚¬ ì£¼ì†Œì´ë‹¤. ì¦‰, Authorization Codeë¥¼ ì „ë‹¬í•´ ì¤„ ì£¼ì†Œë¥¼ ì˜ë¯¸í•œë‹¤.
2.  Resource Ownerì˜ ì¸ì¦

    ì„œë¹„ìŠ¤ ë“±ë¡ì´ ì™„ë£Œë˜ë©´ Resorce ServerëŠ” Clientì˜ ID, Secret, Redirect URLì„ ì•Œê³  ìžˆë‹¤. ì´ë•Œ Resource ownerê°€ ìš°ë¦¬ ì•±ì—ì„œ Resource serverì˜ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš°ê°€ ìžˆì„ ê²ƒì´ë‹¤.

    ê·¸ëŸ¬ë©´ Clientì—ì„œëŠ” ê·¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë¡œê·¸ì¸ URLì˜ íŒŒë¼ë¯¸í„°ë¡œ **Client ID,** **Scope**, **Redirect URI**ë¥¼ ìž‘ì„±í•œë‹¤. ê·¸ëŸ¼ Authorization Serverì—ì„œ ë¡œê·¸ì¸ì„ í†µí•´ ìœ ì €ëŠ” ìžì‹ ìž„ì„ ì¸ì¦í•œë‹¤.

    Authorization ServerëŠ” ìžì‹ ì˜ ì„œë²„ì—ì„œ í•´ë‹¹ Client IDê°€ ìžˆëŠ”ì§€, ìš”ì²­ì´ ì˜¨ URIì™€, ì„œë²„ì— ì €ìž¥ëœ URI ê°’ì´ ë™ì¼í•œì§€ í™•ì¸í•œë‹¤. ì´í›„ Resorce Ownerì—ê²Œ **Scope**ì— ëŒ€í•œ ì ‘ê·¼ê¶Œí•œì„ í—ˆìš©í•  ê²ƒì¸ì§€ë¥¼ ë³´ì—¬ì£¼ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤. ì´í›„ ì‚¬ìš©ìžê°€ ê¶Œí•œì„ í—ˆìš©í•œ Scope ê°’ì„ Resorce Ownerì˜ IDì™€ í•¨ê»˜ ì €ìž¥í•˜ê²Œ ëœë‹¤.
3.  Authorization Serverì˜ ìŠ¹ì¸

    Authorization ServerëŠ” ë°”ë¡œ Access Tokenì„ ì œê³µí•´ì£¼ì§€ ì•ŠëŠ”ë‹¤!! ìž„ì‹œ ë¹„ë°€ë²ˆí˜¸ì¸ **Authorization code**ë¥¼ Resource Ownerì—ê²Œ ì „ë‹¬í•˜ê²Œ ëœë‹¤. ì´í›„ ì´ ê°’ì„ Clientê°€ ë°›ì•„ì„œ ë‹¤ì‹œ Authorization Serverì— **authorization code**, redirect URI, Client ID, **Client Secret**ë¥¼ ì œê³µí•˜ì—¬ ì¸ì¦í•˜ê²Œ ëœë‹¤.

    ë‚´ê°€ Resource Ownerë¼ê³  ê°€ì •í•˜ê³  ì•±ì„ ìƒê°í•´ë³´ìž. ë‚´ê°€ êµ¬ê¸€ë¡œ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, WebViewë¥¼ í†µí•´ êµ¬ê¸€ì‚¬ì´íŠ¸ê°€ ë‚˜ì˜¬ ê²ƒì´ë‹¤. ë‚´ ì•„ì´ë””ë¥¼ ìž…ë ¥í•˜ê³ , ì–´ë–¤ ê¶Œí•œì„ ì œê³µí•  ê²ƒì¸ì§€ í™•ì¸í•œ í›„ì— ì—°ë™ ë²„íŠ¼ì„ ëˆŒë €ë‹¤. ê·¸ëŸ¬ë©´ Redirect URIë¥¼ í†µí•´ ë‹¤ì‹œ ì•±ìœ¼ë¡œ ëŒì•„ì˜¤ê²Œ ëœë‹¤. ì´ë•Œ, ìš°ë¦¬ì˜ ì•±ì¸ ClientëŠ” WKWebKitì˜ `decidePolicyFor navigationAction` ë¥¼ í†µí•´ì„œ Authorization code ê°’ì„ ìºì¹˜í•  ìˆ˜ ìžˆëŠ” ê²ƒì´ë‹¤. ì´ ê°’ê³¼ client secret ë“± ì •ë³´ë¥¼ ë‹¤ì‹œ Authorization serverì—ê²Œ ì œê³µí•˜ëŠ” ë‹¨ê³„ì¸ ê²ƒì´ë‹¤.
4.  ë§ˆì§€ë§‰! Acess Token ë°œê¸‰

    Authorization ServerëŠ” ì•„ê¹Œ Clientì—ê²Œ Client ID, Secret, URI, Authorization codeê¹Œì§€ ëª¨ë‘ ë°›ì•˜ë‹¤. ê·¸ëŸ¬ë©´ ì´ì œ Authorization Serverê°€ ì¸ì¦í•œ ìœ ì €, ì¸ì¦í•œ í´ë¼ì´ì–¸íŠ¸ê°€ ëœ ê²ƒì´ë‹¤. ì´ì œ Authorization codeëŠ” ì‚­ì œí•œ í›„ì—, Access Tokenì„ ë°œê¸‰í•´ì¤€ë‹¤.

    ì´ì œ Resource Serverì—ê²Œ ë°ì´í„°ë¥¼ ìš”ì²­í•  ë•Œ, Access Tokenì„ í†µí•´ ìš”ì²­ì„ í•˜ê²Œ ë˜ë©´, í•´ë‹¹ Scopeì— ê¶Œí•œì´ ìžˆëŠ”ì§€ í™•ì¸í•˜ê³ , ê·¸ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ì œê³µí•´ì£¼ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

ì „ì²´ì ì¸ íë¦„ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. (client registrationì€ í•´ë‹¹ ëª…ì„¸ ê³¼ì •ì—ì„œ ì œì™¸ë˜ì–´ìžˆë‹¤.)

```
  +--------+                                           +---------------+
  |        |--(A)------- Authorization Grant --------->|               |
  |        |                                           |               |
  |        |<-(B)----------- Access Token -------------|               |
  |        |               & Refresh Token             |               |
  |        |                                           |               |
  |        |                            +----------+   |               |
  |        |--(C)---- Access Token ---->|          |   |               |
  |        |                            |          |   |               |
  |        |<-(D)- Protected Resource --| Resource |   | Authorization |
  | Client |                            |  Server  |   |     Server    |
  |        |--(E)---- Access Token ---->|          |   |               |
  |        |                            |          |   |               |
  |        |<-(F)- Invalid Token Error -|          |   |               |
  |        |                            +----------+   |               |
  |        |                                           |               |
  |        |--(G)----------- Refresh Token ----------->|               |
  |        |                                           |               |
  |        |<-(H)----------- Access Token -------------|               |
  +--------+           & Optional Refresh Token        +---------------+
```



#### Refresh token

Access Tokenì€ ìˆ˜ëª…ì´ ì •í•´ì ¸ìžˆë‹¤. ì´ ìˆ˜ëª…ì´ ëë‚˜ë©´, í•´ë‹¹ Access Tokenìœ¼ë¡œëŠ” ClientëŠ” ìš”ì²­ì„ ë³´ë‚´ë©´, ì¸ì¦ ì—ëŸ¬ë¼ëŠ” ì‘ë‹µë§Œ ë°›ê²Œ ë  ê²ƒì´ë‹¤. ê·¸ë ‡ë‹¤ë©´ ì´ ìˆ˜ëª…ì´ ëë‚  ë•Œë§ˆë‹¤ ì‚¬ìš©ìžëŠ” ë¡œê·¸ì¸ì„ í•´ì•¼í•  ìˆ˜ë„ ìžˆë‹¤. ìš°ë¦¬ëŠ” ì´ë•Œ Refresh Tokenì„ ì´ìš©í•´ì„œ ì‚¬ìš©ìž ë¡œê·¸ì¸ ì—†ì´ Access Tokenì„ ìƒˆë¡œ ë°œê¸‰ë°›ì„ ìˆ˜ ìžˆë‹¤.

ë³´í†µ Access Tokenì„ ë°œê¸‰ë°›ì„ ë•Œ, Refresh Tokenì„ ê°™ì´ ì œê³µí•´ì¤€ë‹¤. Resource Serverì™€ AccessTokenìœ¼ë¡œ í†µì‹ ì„ í•˜ë˜ ì¤‘ Invalid token errorê°€ ë°œìƒí•˜ë©´, ClientëŠ” Authorization Serverì—ê²Œ Refresh Tokenì„ ë³´ë‚´ì„œ ë‹¤ì‹œ Access Tokenì„ ë°œê¸‰ë°›ê²Œ ëœë‹¤.

Refresh Tokenìœ¼ë¡œ Access Tokenì„ ìž¬ë°œê¸‰ ë°›ì„ ìˆ˜ ìžˆê¸° ë•Œë¬¸ì—, Refresh Tokenì€ ì•ˆì „í•˜ê²Œ ì €ìž¥ë˜ì–´ì•¼í•˜ë©°, Refresh Tokenì´ ë§Œë£Œë˜ë©´ ì‚¬ìš©ìžëŠ” ìž¬ë¡œê·¸ì¸í•´ì•¼í•œë‹¤.

```
	+--------+                                           +---------------+
  |        |--(A)------- Authorization Grant --------->|               |
  |        |                                           |               |
  |        |<-(B)----------- Access Token -------------|               |
  |        |               & Refresh Token             |               |
  |        |                                           |               |
  |        |                            +----------+   |               |
  |        |--(C)---- Access Token ---->|          |   |               |
  |        |                            |          |   |               |
  |        |<-(D)- Protected Resource --| Resource |   | Authorization |
  | Client |                            |  Server  |   |     Server    |
  |        |--(E)---- Access Token ---->|          |   |               |
  |        |                            |          |   |               |
  |        |<-(F)- Invalid Token Error -|          |   |               |
  |        |                            +----------+   |               |
  |        |                                           |               |
  |        |--(G)----------- Refresh Token ----------->|               |
  |        |                                           |               |
  |        |<-(H)----------- Access Token -------------|               |
  +--------+           & Optional Refresh Token        +---------------+
```

#### OauthëŠ” ê·¸ëž˜ì„œ ì™œ ì“°ëŠ”ê±´ë°?

Client ìž…ìž¥ì—ì„œëŠ” Resource serverë¥¼ í†µí•´ ownerì˜ ì‹ ì›ì€ ì¸ì¦í•  ìˆ˜ ìžˆë‹¤. ë˜í•œ resource ownerëŠ” clientì—ê²Œ êµ¬ê¸€ì˜ IDë‚˜ PWë¥¼ ì œê³µí•˜ì§€ ì•Šê³ ë„, êµ¬ê¸€ì˜ ì„œë¹„ìŠ¤ë¥¼ clientì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìžˆê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

ì¦‰, í›¨ì”¬ ë” ì•ˆì „í•˜ê³  ê°„íŽ¸í•œ ë°©ë²•ìœ¼ë¡œ ì„œë¡œë¥¼ ì¸ì¦í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì´ë‹¤ !

#### ì¶œì²˜

[WEB2 - OAuth 2.0 : 1.á„‰á…®á„‹á…¥á†¸á„‰á…©á„€á…¢](https://www.youtube.com/watch?v=hm2r6LtUbk8)

[RFC 6749: The OAuth 2.0 Authorization Framework](https://datatracker.ietf.org/doc/html/rfc6749#section-1.1)
